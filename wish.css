/* Base */
:root{
  --bg1:#0f0c29; --bg2:#302b63; --bg3:#24243e; --ink:#f8f7ff; --muted:#cecde3;
  --gold:#ffd166; --accent:#fb5607;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink); font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial;
  background: radial-gradient(1200px 600px at 10% 10%, #1d114e33, transparent),
              radial-gradient(900px 500px at 90% 20%, #46175a55, transparent),
              linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));
  overflow:hidden; -webkit-text-size-adjust:100%; -ms-text-size-adjust:100%;
  touch-action: manipulation; /* Improve touch performance */
}

#bg{position:fixed;inset:0;width:100%;height:100%;z-index:0}

.card{ position:relative; z-index:1; width:100vw; height:100vh; margin:0; padding:clamp(20px,5vmin,40px);
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  transition: opacity 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-sizing:border-box;
}
.card.hidden{ opacity:0; transform:translateY(20px); pointer-events:none; }
.hdr{ text-align:center; margin-bottom:clamp(30px,8vw,60px); }
.hdr::before{ content:''; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:200vw; height:200vh; background:radial-gradient(circle, rgba(255,209,102,0.03) 0%, rgba(255,209,102,0.01) 30%, transparent 60%); z-index:-1; pointer-events:none; }
.script{ font-family:"Great Vibes",cursive; font-size:clamp(48px,12vw,110px); margin:clamp(8px,3vw,20px) 0; letter-spacing:.5px;
  background:linear-gradient(180deg,#fff,#ffeaa7 45%,#ffbe0b,#fb5607 90%);
  -webkit-background-clip:text; background-clip:text; color:transparent; 
  text-shadow:0 0 30px #ffd16666, 0 0 60px #ff9f1c44, 0 0 100px #fb560722;
  line-height:1.1; word-wrap:break-word; filter:drop-shadow(0 4px 12px #00000030);
}
.tag{ margin:0; color:var(--muted); font-size:clamp(14px,3.5vw,18px); letter-spacing:1px; text-shadow:0 2px 8px #00000040; }

.wish{ display:grid; place-items:center; gap:clamp(20px,5vw,40px); margin-top:clamp(40px,8vw,60px); max-width:800px; }
.diya svg{ filter:drop-shadow(0 15px 30px #00000050) drop-shadow(0 0 40px #ffd16644); width:clamp(200px,40vw,280px); height:auto; }
.flame{ filter: drop-shadow(0 0 22px #ffd166aa) drop-shadow(0 0 36px #ff9f1c66) }
.line{ font-size:clamp(20px,4.5vw,28px); margin:clamp(8px,2vw,16px) 0; color:#e9e6ff; line-height:1.3; text-shadow:0 3px 10px #00000050; font-weight:500; }
.msg{ font-size:clamp(18px,4.5vw,30px); text-align:center; margin:clamp(12px,3vw,20px) 0 clamp(16px,4vw,24px); color:#fff; max-width:50ch; line-height:1.5; text-shadow:0 3px 12px #00000060; }
.highlight{ color:#ffd166; font-weight:800; text-shadow:0 0 10px #ffd16666 }

.actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:8px }
.btn{ cursor:pointer; border:1px solid #ffffff2a; background:#1b1538; color:#e9e6ff; padding:clamp(10px,3vw,16px) clamp(12px,4vw,20px); border-radius:clamp(8px,2vw,12px); font-weight:700; box-shadow:0 8px 22px #0007; font-size:clamp(14px,3.5vw,16px); min-height:44px; /* Touch target size */ }
.btn:hover{ filter:brightness(1.05); transform:translateY(-1px) }
.btn:active{ transform:translateY(1px) scale(.99) }
.btn.gold{ color:#321c00; background:linear-gradient(180deg,#fff2 0,#fff0 12%), linear-gradient(90deg,#ffe29f,#ffc93c,#f9a620) }
.btn.primary{ background:#2a2b6b }

footer{ text-align:center; color:#fff9; margin-top:clamp(30px,6vw,50px); font-size:clamp(12px,3vw,14px); text-shadow:0 2px 6px #00000040; }

/* 3-dot menu */
.more-wrap{ position:absolute; top:clamp(12px,3vw,20px); right:clamp(12px,3vw,20px); z-index:3 }
.icon-btn{ position:relative; z-index:2; width:clamp(38px,10vw,48px); height:clamp(38px,10vw,48px); border-radius:clamp(8px,2vw,12px); border:1px solid #ffffff2a; background:#110a2acc; color:#fff; font-size:clamp(18px,5vw,24px); line-height:1; cursor:pointer; box-shadow:0 6px 16px #0007; min-height:44px; min-width:44px; /* Touch target */ }
.icon-btn:hover{ filter:brightness(1.08) }
.menu{ position:absolute; top:46px; right:0; z-index:3; background:#160f3a; border:1px solid #ffffff22; border-radius:12px; padding:6px; box-shadow:0 18px 40px #000a; display:none; gap:4px; min-width:160px }
.more-wrap:hover .menu, .more-wrap:focus-within .menu{ display:grid }
.menu .menu-item{ text-align:left; padding:clamp(12px,3vw,16px) clamp(14px,4vw,18px); border:0; background:transparent; color:#fff; border-radius:clamp(6px,2vw,10px); cursor:pointer; font-size:clamp(14px,3.5vw,16px); min-height:44px; /* Touch target */ }
.menu .menu-item:hover{ background:#ffffff15 }

/* Dialog */
.overlay{ position:fixed; inset:0; display:grid; place-items:center; background:#0b0625aa; backdrop-filter: blur(4px); z-index:2 }
/* Ensure hidden attribute truly hides the overlay even with explicit display */
.overlay[hidden]{ display:none !important; }
.dialog{ width:min(560px,92vw); background:#160f3a; color:#fff; border:1px solid #ffffff22; border-radius:16px; padding:16px; box-shadow:0 18px 50px #000a }
.lbl{ display:block; color:#ddd; margin:12px 0 6px }
#nameInput{ width:100%; padding:12px 14px; border-radius:12px; border:1px solid #ffffff33; background:#1b1538; color:#fff; outline:none }
#nameInput:focus{ border-color:var(--gold); box-shadow:0 0 0 3px #ffd16633 }
.chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
.chip{ cursor:pointer; border:1px solid #ffffff33; background:#221a52; color:#fff; padding:8px 12px; border-radius:999px }
.dlg-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:12px }

/* Game overlay - fullscreen */
.dialog.game{ width:100vw; height:100vh; margin:0; padding:0; background:transparent; border:none; box-shadow:none; border-radius:0; }
.scatter{ position:fixed; inset:0; width:100vw; height:100vh; margin:0; background:transparent; border:none; overflow:hidden; }

/* Dynamic background overlay for lighting effect */
.game-bg-overlay{ position:fixed; inset:0; background: rgba(5, 3, 15, 0.9); transition: background 0.8s cubic-bezier(0.4, 0.0, 0.2, 1); z-index:1; pointer-events:none; }
.game-bg-overlay.lit-1{ background: rgba(5, 3, 15, 0.8); }
.game-bg-overlay.lit-2{ background: rgba(8, 5, 18, 0.7); }
.game-bg-overlay.lit-3{ background: rgba(12, 8, 22, 0.6); }
.game-bg-overlay.lit-4{ background: rgba(16, 12, 26, 0.5); }
.game-bg-overlay.lit-5{ background: rgba(20, 15, 30, 0.4); }
.game-bg-overlay.lit-6{ background: rgba(25, 18, 35, 0.3); }
.game-bg-overlay.lit-7{ background: rgba(30, 22, 40, 0.1); }
.node{ position:absolute; width:clamp(80px,18vw,110px); height:clamp(80px,18vw,110px); touch-action:none; user-select:none; z-index:5; transition:left .06s linear, top .06s linear; will-change:left, top; }
.node.hero{ z-index:6; animation: float 3.5s ease-in-out infinite; }
@keyframes float{ 0%{ transform:translateY(0) } 50%{ transform:translateY(-4px) } 100%{ transform:translateY(0) } }
.node .bowl{ position:absolute; left:50%; transform:translateX(-50%); bottom:21px; width:60px; height:25px; background: linear-gradient(180deg, #6d3900, #c76f00); border-radius:0 0 21px 21px; box-shadow: inset 0 5px 14px #fff2, 0 4px 12px #0009; opacity:.6 }
.node.lit .bowl{ opacity:1; box-shadow: inset 0 4px 12px #fff2, 0 3px 10px #0009, 0 0 20px #ffd16644; }
.node .flame{ position:absolute; left:50%; transform:translateX(-50%); bottom:48px; width:25px; height:35px; border-radius:50% 50% 50% 50% / 60% 60% 40% 40%; background: radial-gradient(circle at 50% 30%, #fff7cc, #ffd166 60%, #fb5607 100%); filter: drop-shadow(0 0 21px #ffd166cc) drop-shadow(0 0 35px #ff9f1caa) drop-shadow(0 0 58px #ffd16655); display:none; will-change: transform, filter; animation: flameFlicker 2.2s ease-in-out infinite alternate; }
.node.lit .flame{ display:block; }
.node.hero.lit .flame{ width:30px; height:41px; filter: drop-shadow(0 0 28px #ffd166ee) drop-shadow(0 0 46px #ff9f1ccc) drop-shadow(0 0 81px #ffd16688); animation-duration: 1.8s; }
.node.lit{ cursor:grab; transition:transform .15s ease-out, filter .15s ease-out; }
.node.lit:hover{ transform:scale(1.05); filter:brightness(1.1); }
.node.lit:active{ cursor:grabbing; transform:scale(1.08); filter:brightness(1.15); }
.node.lit.dragging{ transition:none; z-index:10; }

/* Smooth and flexible flame animation */
@keyframes flameFlicker{
  0%{ transform:translateX(-50%) translateY(0) scale(1); filter: drop-shadow(0 0 16px #ffd166cc) drop-shadow(0 0 28px #ff9f1caa) drop-shadow(0 0 44px #ffd16655); }
  50%{ transform:translateX(-50%) translateY(-2px) scale(1.06); filter: drop-shadow(0 0 22px #ffd166dd) drop-shadow(0 0 36px #ff9f1cb3) drop-shadow(0 0 60px #ffd16666); }
  100%{ transform:translateX(-50%) translateY(0) scale(1); filter: drop-shadow(0 0 18px #ffd166cc) drop-shadow(0 0 30px #ff9f1caa) drop-shadow(0 0 50px #ffd16655); }
}

/* Make the main card diya flame brighter too */
.diya svg .flame{ filter: drop-shadow(0 0 24px #ffd166cc) drop-shadow(0 0 38px #ff9f1c88) drop-shadow(0 0 60px #ffd16655); }

/* Toast */
#toast{ position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:#120c30cc; border:1px solid #ffffff22; color:#fff; padding:10px 14px; border-radius:10px; backdrop-filter: blur(6px); z-index:3; opacity:0; pointer-events:none; transition:opacity .2s, transform .2s }
#toast.show{ opacity:1; transform:translateX(-50%) translateY(-4px) }

/* Mobile-specific improvements */
@media (max-width: 768px) {
  .card{ padding:clamp(16px,4vw,32px); }
  .wish{ gap:clamp(15px,4vw,30px); margin-top:clamp(30px,6vw,40px); }
  .more-wrap{ top:clamp(8px,2vw,16px); right:clamp(8px,2vw,16px); }
  .menu{ min-width:clamp(140px,35vw,180px); }
  .hdr{ margin-bottom:clamp(20px,6vw,40px); }
}

@media (max-width: 480px) {
  .script{ font-size:clamp(40px,14vw,70px); }
  .tag{ font-size:clamp(12px,3.5vw,14px); }
  .line{ font-size:clamp(18px,5vw,24px); }
  .msg{ font-size:clamp(16px,5vw,24px); }
}

/* Landscape mobile optimization */
@media (max-height: 500px) and (orientation: landscape) {
  .script{ font-size:clamp(32px,10vw,56px); }
  .wish{ gap:clamp(10px,3vw,20px); margin-top:clamp(20px,4vw,30px); }
  .hdr{ margin-bottom:clamp(15px,4vw,25px); }
}

/* Desktop/PC-specific optimizations */
@media (min-width: 1024px) {
  .script{ font-size:clamp(64px,7vw,84px); }
  .tag{ font-size:clamp(14px,1.5vw,16px); }
  .line{ font-size:clamp(18px,2vw,22px); }
  .msg{ font-size:clamp(20px,2.2vw,24px); }
  .wish{ gap:clamp(25px,3vw,35px); margin-top:clamp(40px,5vw,50px); max-width:600px; }
  .hdr{ margin-bottom:clamp(35px,4vw,45px); }
  .diya svg{ width:clamp(220px,25vw,260px); }
  footer{ font-size:clamp(12px,1.2vw,13px); margin-top:clamp(35px,4vw,45px); }
  .more-wrap{ top:16px; right:16px; }
  .icon-btn{ width:40px; height:40px; font-size:20px; }
  .menu{ min-width:160px; }
  .menu .menu-item{ padding:10px 14px; font-size:14px; }
  .btn{ padding:12px 18px; font-size:14px; }
}

/* Large desktop optimization */
@media (min-width: 1440px) {
  .script{ font-size:clamp(72px,5.5vw,78px); }
  .line{ font-size:20px; }
  .msg{ font-size:22px; }
  .wish{ gap:30px; margin-top:45px; max-width:550px; }
  .hdr{ margin-bottom:40px; }
  .diya svg{ width:240px; }
  footer{ font-size:12px; margin-top:40px; }
  .node{ width:90px; height:90px; } /* Slightly smaller game diyas on desktop */
}
